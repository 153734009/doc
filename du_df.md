##du和df的区别
在Linux下查看磁盘空间使用情况，最常使用的就是du和df了。然而两者还是有很大区别的，有时候其输出结果甚至非常悬殊。
###工作原理
1. du的工作原理  
du=[ Disk Usage ]命令会对待统计文件逐个调用fstat这个系统调用，获取文件大小。它的数据是基于文件获取的，所以有很大的灵活性，不一定非要针对一个分区，可以跨越多个分区操作。如果针对的目录中文件很多，du速度就会很慢了。
2. df的工作原理  
df=[ Disk Free ]命令使用的事statfs这个系统调用，直接读取分区的超级块信息获取分区使用情况。它的数据是基于分区元数据的，所以只能针对整个分区。由于df直接读取超级块，所以运行速度不受文件多少影响。

###不一致的原因
    常见的df和du不一致情况就是文件删除的问题。当一个文件被删除后，在文件系统目录中已经不可见了，所以du就不会再统计它了。然而如果此时还有运行的进程持有这个已经被删除了的文件的句柄，那么这个文件就不会真正在磁盘中被删除，分区超级块中的信息也就不会更改。这样df仍旧会统计这个被删除了的文件。

###解决方法
知道了原因就好操作了，只需要把持有文件句柄的进程删掉就可以了。就这么简单！  
使用lsof命令查看打开文件的进程，停止响应的进程即可。  
lsof（list open files）是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。
###工作中需要注意的地方
(1)当出现du和df差距很大的情况时，考虑是否是有删除文件未完成造成的，方法是lsof命令，然后停止相关进程即可。  
(2)可以使用清空文件的方式来代替删除文件，方式是:echo > myfile.iso。  
(3)对于经常发生删除问题的日志文件，以改名、清空、删除的顺序操作。  
(4)除了rm外，有些命令会间接的删除文件，如gzip命令完成后会删除原来的文件，为了避免删除问题，压缩前先确认没有进程打开该文件。  
